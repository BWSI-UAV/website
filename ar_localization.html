

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ARTag Localization &mdash; Autonomous UAV Racing 0.1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Autonomous UAV Racing
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Course Agenda:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">BWSI’s Autonomous UAV Racing</a></li>
<li class="toctree-l1"><a class="reference internal" href="initial_setup.html">Module 0: UAV Environment Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="quadrotor_basics.html">Module 1: Hands-On Quadrotors</a></li>
<li class="toctree-l1"><a class="reference internal" href="computer_vision.html">Module 2: Computer Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="planning_control.html">Module 3: Estimation &amp; Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="racing_challenges.html">Module 4: Racing Challenges</a></li>
</ul>
<p class="caption"><span class="caption-text">Practicals:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="project_workflow.html">Project Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="student_drone_setup.html">Student Drone Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="calibration.html">Calibrating Intel RTF Drones</a></li>
<li class="toctree-l1"><a class="reference internal" href="flight_log_analysis.html">Flight Log Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="intel_rtf_architecture.html">Architecture Concept Review</a></li>
<li class="toctree-l1"><a class="reference internal" href="ros_introduction.html">Intro to ROS</a></li>
<li class="toctree-l1"><a class="reference internal" href="communication_pipeline.html">Communication Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="accessing_video_streams.html">Accessing Video Streams</a></li>
<li class="toctree-l1"><a class="reference internal" href="internal_sensor_testing.html">Inspecting Sensor Feeds</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_optical_flow.html">Hovering with Optical Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="coordinate_transforms.html">Coordinate Frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="downward_cam_bag.html">Downward Camera Recording + Line Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="detector.html">Custom ROS Message for Line Params</a></li>
<li class="toctree-l1"><a class="reference internal" href="open_loop_translation_control.html">OFFBOARD Mode &amp; Open Loop Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="yaw_color_tracker.html">Yaw-Only Color Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="line_following.html">Line Following</a></li>
<li class="toctree-l1"><a class="reference internal" href="obstacle_avoidance.html">AR Obstacle Avoidance</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced Topics:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="exploring_px4_firmware.html">Exploring PX4 Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="kalman_filters.html">Kalman Filters</a></li>
</ul>
<p class="caption"><span class="caption-text">Supplemental Material:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="team_roles.html">Team Roles</a></li>
<li class="toctree-l1"><a class="reference internal" href="safety_checklist.html">Safety Checklist</a></li>
<li class="toctree-l1"><a class="reference internal" href="Glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Autonomous UAV Racing</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>ARTag Localization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/ar_localization.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="ARTag-Localization">
<h1>ARTag Localization<a class="headerlink" href="#ARTag-Localization" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial we will continue to explore how the various sensors on
board the Intel Aero Drone can provide information on where the drone is
in the world (i.e.&nbsp;localizations), which is a critical first step to
autonomous navigation. Here we will explore the use of visual fiducial
known as an <a class="reference external" href="https://en.wikipedia.org/wiki/ARTag">ARTag</a>. See below
for an example.</p>
<div class="figure" id="id1">
<img alt="Source: http://wiki.ros.org/ar_track_alvar" src="http://wiki.ros.org/ar_track_alvar?action=AttachFile&amp;do=get&amp;target=artags.png" />
<p class="caption"><span class="caption-text">Source: <a class="reference external" href="http://wiki.ros.org/ar_track_alvar">http://wiki.ros.org/ar_track_alvar</a></span></p>
</div>
<p>In the <a class="reference external" href="enable_optical_flow.html">optical flow</a> tutorial, we saw how
the combination of the TeraRanger distance sensor, downward facing
camera, and “black box” service/software <code class="docutils literal notranslate"><span class="pre">aero-optical-flow</span></code> enabled
the new flight mode of <code class="docutils literal notranslate"><span class="pre">POSITION</span> <span class="pre">CONTROL</span></code> which was significantly
easier to pilot than <code class="docutils literal notranslate"><span class="pre">MANUAL</span></code>.</p>
<p>This tutorial will similarly use an onboard camera and pre-compiled
libraries/software to provide a form of positioning information. In
contrast to the optical flow tutorial, we will be using the front-facing
<a class="reference external" href="https://en.wikipedia.org/wiki/Intel_RealSense">RealSense</a> camera
suite and the <code class="docutils literal notranslate"><span class="pre">ar_track_alvar</span></code> ROS package (see
<a class="reference external" href="http://wiki.ros.org/ar_track_alvar">here</a> for more details).</p>
<div class="section" id="Launching-RealSense-&amp;-ar_track_alvar">
<h2>Launching RealSense &amp; <code class="docutils literal notranslate"><span class="pre">ar_track_alvar</span></code><a class="headerlink" href="#Launching-RealSense-&-ar_track_alvar" title="Permalink to this headline">¶</a></h2>
<p>To launch both the forward-facing camera and <code class="docutils literal notranslate"><span class="pre">ar_track_alvar</span></code>, you
will need to use ROS’s built in <code class="docutils literal notranslate"><span class="pre">roslaunch</span></code> tool. We have already set
up a launch file that does both of these for you.</p>
<div class="section" id="roslaunch">
<h3>roslaunch<a class="headerlink" href="#roslaunch" title="Permalink to this headline">¶</a></h3>
<p>Syntax: <code class="docutils literal notranslate"><span class="pre">roslaunch</span> <span class="pre">&lt;package</span> <span class="pre">name&gt;</span> <span class="pre">&lt;launchfile&gt;.launch</span> <span class="pre">[&lt;args&gt;]</span></code> In
this case, the package will be <code class="docutils literal notranslate"><span class="pre">aero_control</span></code> and the launch file will
be <code class="docutils literal notranslate"><span class="pre">ar_visualization.launch</span></code>. Go ahead and run
<code class="docutils literal notranslate"><span class="pre">roslaunch</span> <span class="pre">aero_control</span> <span class="pre">ar_visualization.launch</span></code>. This should start
both the camera and <code class="docutils literal notranslate"><span class="pre">ar_track_alvar</span></code>.</p>
</div>
<div class="section" id="ar_track_alvar-topics">
<h3><code class="docutils literal notranslate"><span class="pre">ar_track_alvar</span></code> topics<a class="headerlink" href="#ar_track_alvar-topics" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ar_track_alvar</span></code> publishes the following topics:</p>
<ul class="simple">
<li>/visualization_marker</li>
<li>/ar_pose_marker</li>
</ul>
<p>See if you can determine what type of message is published on each of
these channels using <code class="docutils literal notranslate"><span class="pre">rostopic</span> <span class="pre">info</span> <span class="pre">/&lt;topicname&gt;</span></code> for both. After
doing that, you might try <code class="docutils literal notranslate"><span class="pre">rostopic</span> <span class="pre">echo</span> <span class="pre">/&lt;topicname&gt;</span></code> and holding an
AR tag in front of the drone.</p>
</div>
</div>
<div class="section" id="Visualizing-with-rviz">
<h2>Visualizing with rviz<a class="headerlink" href="#Visualizing-with-rviz" title="Permalink to this headline">¶</a></h2>
<p>On the drone in desktop mode, type <code class="docutils literal notranslate"><span class="pre">rviz</span></code> in an open Terminal window.
The ROS visualization software will then open. You will need to select
certain options to make <code class="docutils literal notranslate"><span class="pre">rviz</span></code> work properly. 1. Select Fixed Frame in
the top left corner of rviz and change it from <code class="docutils literal notranslate"><span class="pre">map</span></code> to
<code class="docutils literal notranslate"><span class="pre">camera_rgb_optical_frame</span></code> <img alt="frame-select.png" src="https://github.com/BWSI-UAV/website/blob/master/docs/images/frame-select.png?raw=true" /> 2. Click Add in the
lower left corner of rviz. <img alt="add-rviz.png" src="https://github.com/BWSI-UAV/website/blob/master/docs/images/add-rviz.png?raw=true" /> 3. Add a Camera Display from
<code class="docutils literal notranslate"><span class="pre">/camera/rgb/image_color</span></code>. <img alt="add-camera-rviz.png" src="https://github.com/BWSI-UAV/website/blob/master/docs/images/add-camera-rviz.png?raw=true" /> 4. Add a TF display.
<img alt="add-tf-rviz.png" src="https://github.com/BWSI-UAV/website/blob/master/docs/images/add-tf-rviz.png?raw=true" /> 5. Deselect “All Enabled” under “Frames” in the TF
display options. (You can also resize/move your Camera Display to be
more visible) <img alt="disable-frame-rviz.png" src="https://github.com/BWSI-UAV/website/blob/master/docs/images/disable-frame-rviz.png?raw=true" /> 6. Move an AR tag into frame and
watch the label/axes change as you move it around/twist it.</p>
</div>
<div class="section" id="Processing-Marker">
<h2>Processing Marker<a class="headerlink" href="#Processing-Marker" title="Permalink to this headline">¶</a></h2>
<p>In preparation for this week’s challenge, you will need to write your
own ROS node that subscribes to the appropriate ARTag topics, parses
important information from messages, and displays instructions to the
<a class="reference external" href="team_roles.html#Ground-Commander">Ground Commander</a> to aid in flight
maneuvers.</p>
<p>First let’s make sure you have the required libraries installed on your
drone/computer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">ros</span><span class="o">-</span><span class="n">kinetic</span><span class="o">-</span><span class="n">ar</span><span class="o">-</span><span class="n">track</span><span class="o">-</span><span class="n">alvar</span>
</pre></div>
</div>
<p>First, pull from upstream in <code class="docutils literal notranslate"><span class="pre">aero_control</span></code>. Your <code class="docutils literal notranslate"><span class="pre">aero_control</span></code>
directory should now have a files called
<code class="docutils literal notranslate"><span class="pre">ar_localization/src/ar_checker.py</span></code> that has blanks for you to fill
in. Your goal with this file is to read AR tag detections from
<code class="docutils literal notranslate"><span class="pre">ar_track_alvar</span></code> and check to see that the drone is within the proper
range from the tag to be counted as a detection (by default, 0.9 - 1.1m
but we may change this if it proves too easy). Your code should then log
the detection or, if not in the proper position, directions on getting
to the proper position using the information from <code class="docutils literal notranslate"><span class="pre">ar_track_alvar</span></code>. It
should then log the tag as “seen” and display an “Already Seen” message
if it appears again.</p>
<p>You will be able to test your <code class="docutils literal notranslate"><span class="pre">ar_checker.py</span></code> using
<code class="docutils literal notranslate"><span class="pre">ar_checker.launch</span></code>, also in your <code class="docutils literal notranslate"><span class="pre">aero_control</span></code> directory. When
roslaunching, you can use
<code class="docutils literal notranslate"><span class="pre">roslaunch</span> <span class="pre">aero_control</span> <span class="pre">ar_checker.launch</span> <span class="pre">2&gt;/dev/null</span></code> to get rid of
the error stream that MAVROS puts out.</p>
</div>
<div class="section" id="Testing-with-bag-files">
<h2>Testing with bag files<a class="headerlink" href="#Testing-with-bag-files" title="Permalink to this headline">¶</a></h2>
<p>We can test the <code class="docutils literal notranslate"><span class="pre">ar_checker.py</span></code> using a ROS bag file (indicated by a
<code class="docutils literal notranslate"><span class="pre">.bag</span></code> extension). Syntax for rosbag: <code class="docutils literal notranslate"><span class="pre">rosbag</span> <span class="pre">play</span> <span class="pre">&lt;file&gt;.bag</span></code>.</p>
<p>Link for <code class="docutils literal notranslate"><span class="pre">ar_checker.bag</span></code>: <a class="reference external" href="https://goo.gl/uDMUxz">https://goo.gl/uDMUxz</a></p>
<p>Testing procedure for rosbag:</p>
<ol class="arabic simple">
<li>Run <code class="docutils literal notranslate"><span class="pre">roscore</span> <span class="pre">&amp;</span></code> in Terminal on your VM.</li>
<li>Open another Terminal window and run <code class="docutils literal notranslate"><span class="pre">rosbag</span> <span class="pre">play</span> <span class="pre">ar_checker.bag</span></code>
in the proper directory (likely <code class="docutils literal notranslate"><span class="pre">~/Downloads</span></code>).</li>
<li>Run your <code class="docutils literal notranslate"><span class="pre">ar_checker</span></code> node in a third Terminal window by typing
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">ar_checker.py</span></code> while in the proper <code class="docutils literal notranslate"><span class="pre">aero_control</span></code>
directory.</li>
<li>You can visualize the images in the bag file using
<code class="docutils literal notranslate"><span class="pre">rqt_image_view</span></code>. Note: the detections will not start to appear
until ~10 seconds into the 30 second bag file.</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Ross Allen.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>