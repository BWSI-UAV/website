

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Communication Pipeline &mdash; Autonomous UAV Racing 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Accessing Video Streams" href="accessing_video_streams.html" />
    <link rel="prev" title="Intro to ROS" href="ros_introduction.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Autonomous UAV Racing
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Course Agenda:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">BWSI’s Autonomous UAV Racing</a></li>
<li class="toctree-l1"><a class="reference internal" href="initial_setup.html">Module 0: UAV Environment Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="quadrotor_basics.html">Module 1: Hands-On Quadrotors</a></li>
<li class="toctree-l1"><a class="reference internal" href="computer_vision.html">Module 2: Computer Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="planning_control.html">Module 3: Estimation &amp; Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="racing_challenges.html">Module 4: Racing Challenges</a></li>
</ul>
<p class="caption"><span class="caption-text">Practicals:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="project_workflow.html">Project Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="student_drone_setup.html">Student Drone Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="calibration.html">Calibrating Intel RTF Drones</a></li>
<li class="toctree-l1"><a class="reference internal" href="flight_log_analysis.html">Flight Log Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="intel_rtf_architecture.html">Architecture Concept Review</a></li>
<li class="toctree-l1"><a class="reference internal" href="ros_introduction.html">Intro to ROS</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Communication Pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Talker---Listener">Talker - Listener</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Step-1:-Complete-Talker">Step 1: Complete Talker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Questions-Set-1:">Questions Set 1:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Step-2:-Complete-Listener">Step 2: Complete Listener</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Questions-Set-2:">Questions Set 2:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Step-3:-Launch-Talker-and-Listener">Step 3: Launch Talker and Listener</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Create-Package">Create Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Make-Executables">Make Executables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Launch-File">Launch File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Question-Set-3:">Question Set 3:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Step-4:-Document-and-Push">Step 4: Document and Push</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#MAVROS">MAVROS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Step-1:-Running-MAVROS">Step 1: Running MAVROS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Question-Set-1:">Question Set 1:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Step-2.-Sending-Commands">Step 2. Sending Commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Question-Set-2:">Question Set 2:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Step-3:-Document-and-Push">Step 3: Document and Push</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Advanced-Topics:-uORB">Advanced Topics: uORB</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="accessing_video_streams.html">Accessing Video Streams</a></li>
<li class="toctree-l1"><a class="reference internal" href="internal_sensor_testing.html">Inspecting Sensor Feeds</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable_optical_flow.html">Hovering with Optical Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="coordinate_transforms.html">Coordinate Frames</a></li>
<li class="toctree-l1"><a class="reference internal" href="downward_cam_bag.html">Downward Camera Recording + Line Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="detector.html">Custom ROS Message for Line Params</a></li>
<li class="toctree-l1"><a class="reference internal" href="open_loop_translation_control.html">OFFBOARD Mode &amp; Open Loop Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="yaw_color_tracker.html">Yaw-Only Color Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="line_following.html">Line Following</a></li>
<li class="toctree-l1"><a class="reference internal" href="obstacle_avoidance.html">AR Obstacle Avoidance</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced Topics:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="vim_tutorial.html">Vim Text Editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="exploring_px4_firmware.html">Exploring PX4 Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="kalman_filters.html">Kalman Filters</a></li>
</ul>
<p class="caption"><span class="caption-text">Supplemental Material:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="team_roles.html">Team Roles</a></li>
<li class="toctree-l1"><a class="reference internal" href="safety_checklist.html">Safety Checklist</a></li>
<li class="toctree-l1"><a class="reference internal" href="Glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Autonomous UAV Racing</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Communication Pipeline</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/communication_pipeline.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Communication-Pipeline">
<h1>Communication Pipeline<a class="headerlink" href="#Communication-Pipeline" title="Permalink to this headline">¶</a></h1>
<p>In this unit we will gain understanding and practice on how information is passed between different components of the drone such as the onboard computer (Aero Compute Board) and the flight controller (AeroFC).</p>
<p>You should have already been exposed to the basic concepts of the Robot Operating System (ROS) during the online portion of this class. These concepts including things like nodes, topics, messages, services, etc. If you are unsure/uncomfortable with what these concepts imply, there are great tutorials online for walking you through the basics of ROS. Please see:</p>
<ul class="simple">
<li><p><a class="reference external" href="ros_introduction.html">Intro to ROS</a></p></li>
<li><p><a class="reference external" href="https://erlerobotics.com/blog/ros-introduction/">https://erlerobotics.com/blog/ros-introduction/</a></p></li>
<li><p><a class="reference external" href="http://wiki.ros.org/ROS/Tutorials">http://wiki.ros.org/ROS/Tutorials</a></p></li>
</ul>
<div class="section" id="Talker---Listener">
<h2>Talker - Listener<a class="headerlink" href="#Talker---Listener" title="Permalink to this headline">¶</a></h2>
<p>We are going to put some of basic tools of ROS into practice on the Intel RTF Drone. We are going to start by creating and sending a simple message in one ROS node (i.e. talker) and receiving it in another. This portion relates to <a class="reference external" href="http://wiki.ros.org/ROS/Tutorials/WritingPublisherSubscriber%28python%29">this ROS tutorial</a>, but adapted to our needs.</p>
<p>First make sure you have the most recent codebase on the drone.</p>
<p><em>On drone:</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">bwsi</span><span class="o">-</span><span class="n">uav</span><span class="o">/</span><span class="n">catkin_ws</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">aero_control</span>
<span class="n">git</span> <span class="n">pull</span> <span class="n">upstream</span> <span class="n">master</span>
<span class="n">cd</span> <span class="o">~/</span><span class="n">bwsi</span><span class="o">-</span><span class="n">uav</span><span class="o">/</span><span class="n">catkin_ws</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">aero_control</span><span class="o">/</span><span class="n">communication_pipeline</span>
</pre></div>
</div>
<p>If you try to run <code class="docutils literal notranslate"><span class="pre">simple_talker.py</span></code> and or <code class="docutils literal notranslate"><span class="pre">simple_listener.py</span></code> you will receive an error stating</p>
<p><code class="docutils literal notranslate"><span class="pre">Exception:</span> <span class="pre">CODE</span> <span class="pre">INCOMPLETE!</span> <span class="pre">Delete</span> <span class="pre">this</span> <span class="pre">exception</span> <span class="pre">and</span> <span class="pre">replace</span> <span class="pre">with</span> <span class="pre">your</span> <span class="pre">own</span> <span class="pre">code</span></code></p>
<div class="section" id="Step-1:-Complete-Talker">
<h3>Step 1: Complete Talker<a class="headerlink" href="#Step-1:-Complete-Talker" title="Permalink to this headline">¶</a></h3>
<p>In your preferred text editor, open <code class="docutils literal notranslate"><span class="pre">simple_talker.py</span></code> and replace/fill in the following code block with your own code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;TODO-START: FILL IN CODE HERE</span>
<span class="sd">* create a string message that contains &quot;Hello World&quot; and the iteration number i</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;CODE INCOMPLETE! Delete this exception and replace with your own code&quot;</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;TODO-END &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Once complete, you can run the talker node</p>
<p><em>Terminal 1:</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roscore</span>
</pre></div>
</div>
<p><em>Terminal 2:</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">simple_talker</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>After answering the following questions, you can kill the processes by hitting <code class="docutils literal notranslate"><span class="pre">Ctrl-c</span></code> in each terminal</p>
<div class="section" id="Questions-Set-1:">
<h4>Questions Set 1:<a class="headerlink" href="#Questions-Set-1:" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>List all rosnodes that exist after running talker.py</p></li>
<li><p>List all rostopics that are being present after running talker.py</p></li>
<li><p>What command do I run to see what is being published to the <code class="docutils literal notranslate"><span class="pre">/chatter</span></code> topic?</p></li>
<li><p>What would I change in <code class="docutils literal notranslate"><span class="pre">simple_talker.py</span></code> to make it publish messages more frequently?</p></li>
</ol>
</div>
</div>
<div class="section" id="Step-2:-Complete-Listener">
<h3>Step 2: Complete Listener<a class="headerlink" href="#Step-2:-Complete-Listener" title="Permalink to this headline">¶</a></h3>
<p>Now we will incorporate a second rosnode to subscribe to the topic created by <code class="docutils literal notranslate"><span class="pre">simple_talker.py</span></code> and listen to the messages passed. Open <code class="docutils literal notranslate"><span class="pre">simple_listener.py</span></code> and replace/fill in the appropriate code block.</p>
<p>Once complete, you can run the talker and listener nodes</p>
<p><em>Terminal 1:</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roscore</span>
</pre></div>
</div>
<p><em>Terminal 2:</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">simple_talker</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p><em>Terminal 3:</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">simple_listener</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>After answering the following questions, you can kill these processes by hitting <code class="docutils literal notranslate"><span class="pre">Ctrl-C</span></code> in each terminal. You will also want to commit the progress you have made so you can later push it to your team’s MIT GitHub repositories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">bwsi</span><span class="o">-</span><span class="n">uav</span><span class="o">/</span><span class="n">catkin_ws</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">aero_control</span><span class="o">/</span><span class="n">communication_pipeline</span><span class="o">/</span><span class="n">src</span>
<span class="n">git</span> <span class="n">add</span> <span class="o">-</span><span class="n">u</span>
<span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;filling in code for talker and listener&quot;</span>
</pre></div>
</div>
<div class="section" id="Questions-Set-2:">
<h4>Questions Set 2:<a class="headerlink" href="#Questions-Set-2:" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>List all rosnodes that exist after running simple_talker.py and simple_listener.py</p></li>
<li><p>List all rostopics that are being present after running simple_talker.py and simple_listener.py</p></li>
<li><p>In terminal I ran simple_listener.py I see information being printed. Does this mean simple_listner.py is publishing to a topic?</p></li>
</ol>
</div>
</div>
<div class="section" id="Step-3:-Launch-Talker-and-Listener">
<h3>Step 3: Launch Talker and Listener<a class="headerlink" href="#Step-3:-Launch-Talker-and-Listener" title="Permalink to this headline">¶</a></h3>
<p>It’s a cumbersome to be opening a different terminal for every different rosnode you want to start. Instead of doing this, we can use launch files.</p>
<div class="section" id="Create-Package">
<h4>Create Package<a class="headerlink" href="#Create-Package" title="Permalink to this headline">¶</a></h4>
<p>Before we make a launch file, we need to more properly set up our catkin workspace by turning <code class="docutils literal notranslate"><span class="pre">aero_control</span></code> into a ROS Package and indicate it’s dependencies on <code class="docutils literal notranslate"><span class="pre">std_msgs</span></code> and <code class="docutils literal notranslate"><span class="pre">rospy</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">bwsi</span><span class="o">-</span><span class="n">uav</span><span class="o">/</span><span class="n">catkin_ws</span><span class="o">/</span><span class="n">src</span>
<span class="n">catkin_create_pkg</span> <span class="n">aero_control</span> <span class="n">std_msgs</span> <span class="n">rospy</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle"><strong>Note:</strong></p>
<p>Your Intel drone may already have <code class="docutils literal notranslate"><span class="pre">aero_control</span></code> as a package. If you receive the error: <code class="docutils literal notranslate"><span class="pre">catkin_create_pkg:</span> <span class="pre">error:</span> <span class="pre">File</span> <span class="pre">exists:</span> <span class="pre">~/bwsi-uav/catkin_ws/src/aero_control/package.xml</span></code>, then you can skip ahead to <a class="reference external" href="communication_pipeline.html#Make-Executables">Make Executables</a></p>
</div>
<p>This will create files <code class="docutils literal notranslate"><span class="pre">~/bwsi-uav/catkin_ws/src/aero_control/CMakeLists.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">~/bwsi-uav/catkin_ws/src/aero_control/package.xml</span></code>. You’ll want to track these new files on github, so add and commit them so you can later push them to your team’s MIT GitHub:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">bwsi</span><span class="o">-</span><span class="n">uav</span><span class="o">/</span><span class="n">catkin_ws</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">aero_control</span>
<span class="n">git</span> <span class="n">add</span> <span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span> <span class="n">package</span><span class="o">.</span><span class="n">xml</span>
<span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;starting aero_control as a package&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="Make-Executables">
<h4>Make Executables<a class="headerlink" href="#Make-Executables" title="Permalink to this headline">¶</a></h4>
<p>Next you need to make sure that <code class="docutils literal notranslate"><span class="pre">simple_talker.py</span></code> and <code class="docutils literal notranslate"><span class="pre">simple_listener.py</span></code> are <em>executable</em> in order for the launch file to properly access them. This can be done as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">bwsi</span><span class="o">-</span><span class="n">uav</span><span class="o">/</span><span class="n">catkin_ws</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">aero_control</span><span class="o">/</span><span class="n">communication_pipeline</span><span class="o">/</span><span class="n">src</span><span class="o">/</span>
<span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">simple_talker</span><span class="o">.</span><span class="n">py</span>
<span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">simple_listener</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
<div class="section" id="Launch-File">
<h4>Launch File<a class="headerlink" href="#Launch-File" title="Permalink to this headline">¶</a></h4>
<p>Now you are almost ready to run the launch file that starts <code class="docutils literal notranslate"><span class="pre">roscore</span></code>, <code class="docutils literal notranslate"><span class="pre">simple_talker.py</span></code>, and <code class="docutils literal notranslate"><span class="pre">simple_listener.py</span></code> simultaneously. We’ve given you part of the launch file in <code class="docutils literal notranslate"><span class="pre">aero_control/communication_pipeline/launch/simnple_talk_listen.launch</span></code>, but it’s incomplete. Can you figure out what is missing and add it yourself?</p>
<p>Once you’ve filled in the missing part of the launch file, follow these steps to run it</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">bwsi</span><span class="o">-</span><span class="n">uav</span><span class="o">/</span><span class="n">catkin_ws</span><span class="o">/</span>
<span class="n">catkin_make</span>
<span class="n">source</span> <span class="n">devel</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">bash</span>
<span class="n">roslaunch</span> <span class="n">aero_control</span> <span class="n">simple_talk_listen</span><span class="o">.</span><span class="n">launch</span>
</pre></div>
</div>
<p>You should see the print statement from <code class="docutils literal notranslate"><span class="pre">simple_listener.py</span></code> in your terminal.</p>
<p>A useful tool for visualizing how information is being passed by ROS is <code class="docutils literal notranslate"><span class="pre">rqt_graph</span></code> (see references <a class="reference external" href="http://wiki.ros.org/ROS/Tutorials/UnderstandingTopics#Using_rqt_graph">here</a> and <a class="reference external" href="http://wiki.ros.org/rqt_graph">here</a> for more information. With <code class="docutils literal notranslate"><span class="pre">simple_talk_listen.launch</span></code> still running, open a new terminal and run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rosrun</span> <span class="n">rqt_graph</span> <span class="n">rqt_graph</span>
</pre></div>
</div>
</div>
<div class="section" id="Question-Set-3:">
<h4>Question Set 3:<a class="headerlink" href="#Question-Set-3:" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>What needed to be added the launch file?</p></li>
<li><p>With <code class="docutils literal notranslate"><span class="pre">rqt_graph</span></code> open, use the button in upper right corner to save an image of the graph and include it in this report. Which components in the graph indicates rosnodes and which indicate rostopics?</p></li>
<li><p>Why do we need to run the command <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">devel/setup.bash</span></code> before running <code class="docutils literal notranslate"><span class="pre">roslaunch</span></code>?</p></li>
<li><p>Were there any steps that didn’t work or were particularly confusing? How did you work around them?</p></li>
</ol>
</div>
</div>
<div class="section" id="Step-4:-Document-and-Push">
<h3>Step 4: Document and Push<a class="headerlink" href="#Step-4:-Document-and-Push" title="Permalink to this headline">¶</a></h3>
<p>Congratulations! You have implemented one of the basic building blocks of ROS! Now that you have this demo complete, you will want to push your code changes to your team’s MIT GitHub.</p>
<p>First double check that the repository you are working with on your drone or laptop points to the correct remote repository.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">bwsi</span><span class="o">-</span><span class="n">uav</span><span class="o">/</span><span class="n">catkin_ws</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">aero_control</span>
<span class="n">git</span> <span class="n">remote</span> <span class="o">-</span><span class="n">v</span>
</pre></div>
</div>
<p>should return 4 lines of information, the two lines that start with <code class="docutils literal notranslate"><span class="pre">origin</span></code> and end with <code class="docutils literal notranslate"><span class="pre">(fetch)</span></code> and <code class="docutils literal notranslate"><span class="pre">(push)</span></code> should contain the URL of your team’s MIT GitHub repository for <code class="docutils literal notranslate"><span class="pre">aero_control</span></code>. If not, let one of the instructors know so we can sort it out.</p>
<p>If that’s all set and you ran the commit commands in the previous steps, you should now be able to push those changes to to your team’s remote repositories with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="n">master</span>
</pre></div>
</div>
<p>Finally, document the answers to question sets 1-3 and push those to your teams <code class="docutils literal notranslate"><span class="pre">documents</span></code> repository. You can write up the answers any way you want, but the easiest is probably to create a file called <code class="docutils literal notranslate"><span class="pre">communication_pipeline_answers.md</span></code>, and write a bullet point or paragraph for each question.</p>
</div>
</div>
<div class="section" id="MAVROS">
<h2>MAVROS<a class="headerlink" href="#MAVROS" title="Permalink to this headline">¶</a></h2>
<p>In the last section we passed basic messages between two nodes in ROS. This was done entirely in Ubuntu on the Aero Compute Board (or perhaps your laptop); it had no direct communication with the NuttX operating system that was running PX4 firmware on the Aero Flight Controller hardware. It we want our drones to fly autonomously, we need to be able to send commands to and receive sensor information from the flight controller.</p>
<p>Communication with the PX4 Firmware running on the AeroFC board is managed with a service called <a class="reference external" href="https://mavlink.io/en/">MAVLink</a>. Similar to how ROS messages pass information between nodes on Ubuntu, MAVLink messages pass information between ROS/Ubuntu/Aero Compute Board and PX4/NuttX/AeroFC.</p>
<p>The MAVLink protocol is low-level, which makes it powerful, extensible, but also complicated to use. To simplify our lives we will make use of <a class="reference external" href="https://github.com/mavlink/mavros/tree/master/mavros">MAVROS</a>. MAVROS can be thought of as a “wrapper” for MAVLink that simplifies the communication with ROS.</p>
<div class="section" id="Step-1:-Running-MAVROS">
<h3>Step 1: Running MAVROS<a class="headerlink" href="#Step-1:-Running-MAVROS" title="Permalink to this headline">¶</a></h3>
<p>Let’s start by getting MAVROS running. On the drone, use multiple terminals to run the following commands:</p>
<p><em>Terminal 1:</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roscore</span>
</pre></div>
</div>
<p><em>Terminal 2:</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rosrun</span> <span class="n">mavros</span> <span class="n">mavros_node</span> <span class="n">_fcu_url</span><span class="p">:</span><span class="o">=</span><span class="n">tcp</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5760</span> <span class="n">_system_id</span><span class="p">:</span><span class="o">=</span><span class="mi">2</span>
</pre></div>
</div>
<p>After answering the following questions you can kill these processes with <code class="docutils literal notranslate"><span class="pre">Ctrl-C</span></code></p>
<div class="section" id="Question-Set-1:">
<h4>Question Set 1:<a class="headerlink" href="#Question-Set-1:" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>What rosnodes are running?</p></li>
<li><p>In a separate terminal run <code class="docutils literal notranslate"><span class="pre">rosnode</span> <span class="pre">info</span> <span class="pre">mavros</span></code>. Look through the list of <code class="docutils literal notranslate"><span class="pre">mavros</span></code> Subscriptions and Publications. Can you guess which topics could be used to send commands that control the drone? Which ones?</p></li>
<li><p>Some of the topics that <code class="docutils literal notranslate"><span class="pre">mavros</span></code> subscribes and publishes to have similar sounding names because they serve related, but distinct, purpose. For example, can you guess what is the functional difference between Publication: <code class="docutils literal notranslate"><span class="pre">/mavros/local_position/velocity</span></code> and Subscription <code class="docutils literal notranslate"><span class="pre">/mavros/setpoint_velocity/cmd_vel_unstamped</span></code>?</p></li>
<li><p>Inspect the messages being sent on the topic <code class="docutils literal notranslate"><span class="pre">mavros/extended_state</span></code>. Roughly how often do you get a new message? Do you think these messages originate from the Aero Compute Board or the AeroFC?</p></li>
</ol>
</div>
</div>
<div class="section" id="Step-2.-Sending-Commands">
<h3>Step 2. Sending Commands<a class="headerlink" href="#Step-2.-Sending-Commands" title="Permalink to this headline">¶</a></h3>
<p>Next we are going to use the <code class="docutils literal notranslate"><span class="pre">mavros</span></code> node to send commands to PX4 and receive information about the state of the quadrotor. Since we are only learning the communication structure of the drone, we won’t actually be flying it with these commands, just observing that they get passed correctly.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">aero_control/communication_pipeline/src</span></code> you should find two other files <code class="docutils literal notranslate"><span class="pre">dispatcher.py</span></code> and <code class="docutils literal notranslate"><span class="pre">command_generator.py</span></code>. As with the previous section, these files are missing a block of code that you need to fill in; see the code for instructions on what needs to be completed.</p>
<p>Once you have completed writing your code, let’s test it out. On the drone in multiple terminals run:</p>
<p><em>Terminal 1:</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roscore</span>
</pre></div>
</div>
<p><em>Terminal 2:</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rosrun</span> <span class="n">mavros</span> <span class="n">mavros_node</span> <span class="n">_fcu_url</span><span class="p">:</span><span class="o">=</span><span class="n">tcp</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5760</span> <span class="n">_system_id</span><span class="p">:</span><span class="o">=</span><span class="mi">2</span>
</pre></div>
</div>
<p><em>Terminal 3:</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">bwsi</span><span class="o">-</span><span class="n">uav</span><span class="o">/</span><span class="n">catkin_ws</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">aero_control</span><span class="o">/</span><span class="n">communication_pipeline</span><span class="o">/</span><span class="n">src</span>
<span class="n">python</span> <span class="n">dispatcher</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p><em>Terminal 4:</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">bwsi</span><span class="o">-</span><span class="n">uav</span><span class="o">/</span><span class="n">catkin_ws</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">aero_control</span><span class="o">/</span><span class="n">communication_pipeline</span><span class="o">/</span><span class="n">src</span>
<span class="n">python</span> <span class="n">command_generator</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Assuming you got no errors, answer the following questions (if you did get errors, are you able to debug them?)</p>
<div class="section" id="Question-Set-2:">
<h4>Question Set 2:<a class="headerlink" href="#Question-Set-2:" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>What new nodes and topics were created by running dispatcher.py and command_generator.py that weren’t present when just running mavros?</p></li>
<li><p>Inspect the messages being sent on <code class="docutils literal notranslate"><span class="pre">/velocity_command</span></code> and <code class="docutils literal notranslate"><span class="pre">/mavros/setpoint_velocity/cmd_vel_unstamped</span></code>. Do they appear to be the same? Are the being passed at roughly the same rate? Which one is actually being sent to the PX4/AeroFC?</p></li>
<li><p>Why would we want to impose a limit on the velocity command sent to the flight controller?</p></li>
<li><p>As with the previous section, it is cumbersome to run each command in a separate terminal. To this end we have included a partial launch file in <code class="docutils literal notranslate"><span class="pre">aero_control/communication_pipeline/launch/mavros.launch</span></code>. Can you complete the launch file and run it in order to kick off mavros, dispatcher, and command_generator simultaneously?</p></li>
<li><p>When all nodes are running, use rqt_graph to generate an image of the nodes and topics.</p></li>
</ol>
</div>
</div>
<div class="section" id="Step-3:-Document-and-Push">
<h3>Step 3: Document and Push<a class="headerlink" href="#Step-3:-Document-and-Push" title="Permalink to this headline">¶</a></h3>
<p>As before, document the answers to the preceeding question sets and push them to your team’s <code class="docutils literal notranslate"><span class="pre">documents</span></code> repository</p>
</div>
</div>
<div class="section" id="Advanced-Topics:-uORB">
<h2>Advanced Topics: uORB<a class="headerlink" href="#Advanced-Topics:-uORB" title="Permalink to this headline">¶</a></h2>
<p>So far we have only seen communication on the Aero Compute Board and how to pass messages to the Aero Flight Controller. We haven’t actually looked at message passing that occurs onboard the Aero Flight Controller in the PX4 firmware. The Aero Flight Controller uses a different system known as “uORB”. We will cover this in a later lecture but you can learn more uORB in the link below:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://dev.px4.io/en/middleware/">uORB Messaging</a></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="accessing_video_streams.html" class="btn btn-neutral float-right" title="Accessing Video Streams" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ros_introduction.html" class="btn btn-neutral float-left" title="Intro to ROS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Ross Allen

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>